---
title: "Mapping Needs"
author: "Alexandra Gonzalez"
date: "1/14/2018"
output: html_document
---


## Overview & Purpose 

The purpose of this document is to sort code, identify coding needs and more. 

1. Sort code 

  #As it currently stands, it is unclear what files represent what and in what order
  the code should be analyzed. First step is clear organization
  
2. Identify if the id_num is being captured in the code

  #For mapping purposes, it is more important to capture the id_num than 
  it is to capture the species name. There can be multiple records 
  of species because they are in different areas. However, these species records
  have different id_num. Therefore, it is important to capture the correct
  id_num to make sure that the threats are for that location
  
3. Map the threats 

  #Once the id_num is assocaited with each species threat table, export the table
  from here to an excel doc. Then, import that doc to ArcGis. 
  ArcGis already has a table (the spatial data from IUCN). This spatial data 
  has information on the polygons and each species range. Conduct a join by the id_num so that
  the threats can be associated with the spatial data. From there, the threats
  can be mapped. 
  

## 1 Sort Code

See file Final Project.R in the Herpetology>code file. This is a good starting point for 
organizing the code. Lays out all of the code that has been written. Good starting point. 


## 2 Identify if id_num is captured in the code

After reading the Final Project file, id_num is NOT captured. Before going back and rewritting
all of the code, some test species are going to be used (about ten or so) and try to map them. 

First will identify which ones are represented in the spatial data and work backwards 
         


```{r libraries_functions, include=FALSE}

## Look on IUCN website. Find 10 amphibian species where spatial data is avaialble. 
## Use written code to create a threat table of these 10 amphibain species with the 
## id_num. Then, import to ArcGis and map. 


library("profvis") 
library("rredlist")
library(RSQLite)
library(sqldf)
library(dplyr)
require(ggplot2)
require(reshape2)
require(scales)
token <- "cf51b7524f618f5b23220e687b70c01d0d240cc82d179cf2c5b08b70fdfb83d4" 


sp_threats <- function(species_list){
  threat_code <- vector(length = length(species_list),
                        mode = "character")
  i <- 1 
  for (species in species_list){
    threats <- rl_threats(species, key = token)
    code <- threats$result$code
    threat_code[i] <- paste(code, collapse = " ")
    i <- i + 1   
  }
  final_results <- data.frame(species_list, threat_code)
  return(final_results)
} #df of species and threat codes 
threat_table <- function(species_list){
  R1.1 <- rep(c(0),  each = length(species_list)) 
  R1.2 <- rep(c(0),  each = length(species_list))
  R1.3 <- rep(c(0),  each = length(species_list))
  
  #Agriculture and Aquaculture 
  A2.1 <- rep(c(0),  each = length(species_list))
  A2.1.1 <- rep(c(0),  each = length(species_list))
  A2.1.2 <- rep(c(0),  each = length(species_list))
  A2.1.3 <- rep(c(0),  each = length(species_list))
  A2.1.4 <- rep(c(0),  each = length(species_list))
  
  A2.2 <- rep(c(0),  each = length(species_list))
  A2.2.1 <- rep(c(0),  each = length(species_list))
  A2.2.2 <- rep(c(0),  each = length(species_list))
  A2.2.3 <- rep(c(0),  each = length(species_list))
  
  A2.3 <- rep(c(0),  each = length(species_list))
  A2.3.1 <- rep(c(0),  each = length(species_list))
  A2.3.2 <- rep(c(0),  each = length(species_list))
  A2.3.3 <- rep(c(0),  each = length(species_list))
  A2.3.4 <- rep(c(0),  each = length(species_list))
  
  A2.4 <- rep(c(0),  each = length(species_list))
  A2.4.1 <- rep(c(0),  each = length(species_list))
  A2.4.2 <- rep(c(0),  each = length(species_list))
  A2.4.3 <- rep(c(0),  each = length(species_list))
  
  #Energy Productoin and mining 
  E3.1 <- rep(c(0),  each = length(species_list)) 
  E3.2 <- rep(c(0),  each = length(species_list))
  E3.3 <- rep(c(0),  each = length(species_list)) 
  
  #Transportation and service corridots 
  T4.1 <- rep(c(0),  each = length(species_list))
  T4.2 <- rep(c(0),  each = length(species_list))
  T4.3 <- rep(c(0),  each = length(species_list))
  T4.4 <- rep(c(0),  each = length(species_list))
  
  #Biological Resource use 
  B5.1 <- rep(c(0),  each = length(species_list))
  B5.1.1 <- rep(c(0),  each = length(species_list))
  B5.1.2 <- rep(c(0),  each = length(species_list))
  B5.1.3 <- rep(c(0),  each = length(species_list))
  B5.1.4 <- rep(c(0),  each = length(species_list))
  
  B5.2 <- rep(c(0),  each = length(species_list))
  B5.2.1 <- rep(c(0),  each = length(species_list))
  B5.2.2 <- rep(c(0),  each = length(species_list))
  B5.2.3 <- rep(c(0),  each = length(species_list))
  B5.2.4 <- rep(c(0),  each = length(species_list))
  
  B5.3 <- rep(c(0),  each = length(species_list))
  B5.3.1 <- rep(c(0),  each = length(species_list))
  B5.3.2 <- rep(c(0),  each = length(species_list))
  B5.3.3 <- rep(c(0),  each = length(species_list))
  B5.3.4 <- rep(c(0),  each = length(species_list))
  B5.3.5 <- rep(c(0),  each = length(species_list))
  
  B5.4 <- rep(c(0),  each = length(species_list))
  B5.4.1 <- rep(c(0),  each = length(species_list))
  B5.4.2 <- rep(c(0),  each = length(species_list))
  B5.4.3 <- rep(c(0),  each = length(species_list))
  B5.4.4 <- rep(c(0),  each = length(species_list))
  B5.4.5 <- rep(c(0),  each = length(species_list))
  B5.4.6 <- rep(c(0),  each = length(species_list))
  
  #Human intrustions and disturbance 
  H6.1 <- rep(c(0),  each = length(species_list))  
  H6.2 <- rep(c(0),  each = length(species_list))
  H6.3 <- rep(c(0),  each = length(species_list))
  
  #Natural system modifications 
  N7.1 <- rep(c(0),  each = length(species_list))
  N7.1.1 <- rep(c(0),  each = length(species_list))
  N7.1.2 <- rep(c(0),  each = length(species_list))
  N7.1.3 <- rep(c(0),  each = length(species_list))
  
  N7.2 <- rep(c(0),  each = length(species_list))
  N7.2.11 <- rep(c(0),  each = length(species_list))
  N7.2.10 <- rep(c(0),  each = length(species_list))
  N7.2.1 <- rep(c(0),  each = length(species_list))
  N7.2.2 <- rep(c(0),  each = length(species_list))
  N7.2.3 <- rep(c(0),  each = length(species_list))
  N7.2.4 <- rep(c(0),  each = length(species_list))
  N7.2.5 <- rep(c(0),  each = length(species_list))
  N7.2.6 <- rep(c(0),  each = length(species_list))
  N7.2.7 <- rep(c(0),  each = length(species_list))
  N7.2.8 <- rep(c(0),  each = length(species_list))
  N7.2.9 <- rep(c(0),  each = length(species_list))
  
  N7.3 <- rep(c(0),  each = length(species_list))
  
  #Invasive and other problematic species, genes and disease 
  I8.1 <- rep(c(0),  each = length(species_list))
  I8.1.1 <- rep(c(0),  each = length(species_list))
  I8.1.2 <- rep(c(0),  each = length(species_list))
  
  I8.2 <- rep(c(0),  each = length(species_list))
  I8.2.1 <- rep(c(0),  each = length(species_list))
  I8.2.2 <- rep(c(0),  each = length(species_list))
  
  I8.3 <- rep(c(0),  each = length(species_list))
  
  I8.4 <- rep(c(0),  each = length(species_list))
  I8.4.1 <- rep(c(0),  each = length(species_list))
  I8.4.2 <- rep(c(0),  each = length(species_list))
  
  I8.5 <- rep(c(0),  each = length(species_list))
  I8.5.1 <- rep(c(0),  each = length(species_list))
  I8.5.2 <- rep(c(0),  each = length(species_list))
  
  I8.6 <- rep(c(0),  each = length(species_list))
  
  #Pollution 
  P9.1 <- rep(c(0),  each = length(species_list))
  P9.1.1 <- rep(c(0),  each = length(species_list))
  P9.1.2 <- rep(c(0),  each = length(species_list))
  P9.1.3 <- rep(c(0),  each = length(species_list))
  
  P9.2 <- rep(c(0),  each = length(species_list))
  P9.2.1 <- rep(c(0),  each = length(species_list))
  P9.2.2 <- rep(c(0),  each = length(species_list))
  P9.2.3 <- rep(c(0),  each = length(species_list))
  
  P9.3 <- rep(c(0),  each = length(species_list))
  P9.3.1 <- rep(c(0),  each = length(species_list))
  P9.3.2 <- rep(c(0),  each = length(species_list))
  P9.3.3 <- rep(c(0),  each = length(species_list))
  P9.3.4 <- rep(c(0),  each = length(species_list))
  
  P9.4 <- rep(c(0),  each = length(species_list))
  
  P9.5 <- rep(c(0),  each = length(species_list))
  P9.5.1 <- rep(c(0),  each = length(species_list))
  P9.5.2 <- rep(c(0),  each = length(species_list))
  P9.5.3 <- rep(c(0),  each = length(species_list))
  P9.5.4 <- rep(c(0),  each = length(species_list))
  
  P9.6 <- rep(c(0),  each = length(species_list))
  P9.6.1 <- rep(c(0),  each = length(species_list))
  P9.6.2 <- rep(c(0),  each = length(species_list))
  P9.6.3 <- rep(c(0),  each = length(species_list))
  P9.6.4 <- rep(c(0),  each = length(species_list))
  
  #Geological Events 
  G10.1 <- rep(c(0),  each = length(species_list))
  G10.2 <- rep(c(0),  each = length(species_list))
  G10.3 <- rep(c(0),  each = length(species_list))
  
  #Climate Change and severe weather 
  C11.1 <- rep(c(0),  each = length(species_list))
  C11.2 <- rep(c(0),  each = length(species_list))
  C11.3 <- rep(c(0),  each = length(species_list))
  C11.4 <- rep(c(0),  each = length(species_list))
  C11.5 <- rep(c(0),  each = length(species_list))
  
  #Other options 
  O12.1 <- rep(c(0),  each = length(species_list))
  
  threat_df <- data.frame(species_list, R1.1, R1.2, R1.3, A2.1, A2.1.1, A2.1.2, A2.1.3, A2.1.4,
                          A2.2, A2.2.1, A2.2.2, A2.2.3, A2.3, A2.3.1, A2.3.2, A2.3.3, A2.3.4, 
                          A2.4, A2.4.1, A2.4.2, A2.4.3, E3.1, E3.2, E3.3, T4.1, T4.2, T4.3, T4.4, 
                          B5.1, B5.1.1, B5.1.2, B5.1.3, B5.1.4, B5.2, B5.2.1, B5.2.2, B5.2.3, B5.2.4, 
                          B5.3, B5.3.1, B5.3.2, B5.3.3, B5.3.4, B5.3.5, B5.4, B5.4.1, B5.4.2, B5.4.3,
                          B5.4.4, B5.4.5, B5.4.6,
                          H6.1, H6.2, H6.3, N7.1, N7.1.1,
                          N7.1.2, N7.1.3, N7.2, N7.2.1, N7.2.2, N7.2.3, N7.2.4, N7.2.5, N7.2.6, N7.2.7,
                          N7.2.8, N7.2.9, N7.2.10, N7.2.11, N7.3, I8.1, I8.1.1, I8.1.2, I8.2, I8.2.1, 
                          I8.2.2, I8.3, I8.4, I8.4.1, I8.4.2, I8.5, I8.5.1, I8.5.2, I8.6, P9.1,P9.1.1,
                          P9.1.2, P9.1.3, P9.2,P9.2.1, P9.2.2, P9.2.3, P9.3, P9.3.1, P9.3.2, P9.3.3, 
                          P9.3.4, P9.4,P9.5, P9.5.1,P9.5.2, P9.5.3, P9.5.4, P9.6,P9.6.1, P9.6.2, P9.6.3, 
                          P9.6.4, G10.1, G10.2, G10.3, C11.1, C11.2, C11.3, C11.4, C11.5)
  return(threat_df)
} #Empty table of threats
pop_threat_tables <- function(data){
  ### data is a dataframe with the species_list  
  ### as one column and the threat_code as the
  ### other aims to work directly with sp_habitats 
  ###and habitat_tables 
  threatdf <- threat_table(data$species_list)
  i <- 1
  for (strings in data$threat_code){
    many_strings <- strsplit(strings, split = " ")
    for (elem in many_strings){
      for(code in elem){
        #### Residential 
        if (code == "1.1"){
          threatdf$R1.1[i] <- 1
        } else if (code == "1.2"){
          threatdf$R1.2[i] <- 1
        } else if (code == "1.3"){
          threatdf$R1.3[i] <- 1
          #### Agriculture 
        } else if (code == "2.1"){
          threatdf$A2.1[i] <- 1
        } else if (code == "2.1.1"){
          threatdf$A2.1.1[i] <- 1
        } else if (code == "2.1.2"){
          threatdf$A2.1.2[i] <- 1
        } else if (code == "2.1.3"){
          threatdf$A2.1.3[i] <- 1
        } else if (code == "2.1.4"){
          threatdf$A2.1.4[i] <- 1
          
        } else if (code == "2.2"){
          threatdf$A2.2[i] <- 1
        } else if (code == "2.2.1"){
          threatdf$A2.2.1[i] <- 1
        } else if (code == "2.2.2"){
          threatdf$A2.2.2[i] <- 1
        } else if (code == "2.2.3"){
          threatdf$A2.2.3[i] <- 1
          
        } else if (code == "2.3"){
          threatdf$A2.3[i] <- 1
        } else if (code == "2.3.1"){
          threatdf$A2.3.1[i] <- 1
        } else if (code == "2.3.2"){
          threatdf$A2.3.2[i] <- 1
        } else if (code == "2.3.3"){
          threatdf$A2.3.3[i] <- 1
        } else if (code == "2.3.4"){
          threatdf$A2.3.4[i] <- 1
          
        } else if (code == "2.4"){
          threatdf$A2.4[i] <- 1
        } else if (code == "2.4.1"){
          threatdf$A2.4.1[i] <- 1
        } else if (code == "2.4.2"){
          threatdf$A2.4.2[i] <- 1
        } else if (code == "2.4.3"){
          threatdf$A2.4.3[i] <- 1
          #### Energy 
        } else if (code == "3.1"){
          threatdf$E3.1[i] <- 1
        } else if (code == "3.2"){
          threatdf$E3.2[i] <- 1
        } else if (code == "3.3"){
          threatdf$E3.3[i] <- 1
          
          #### Transportation and service corridors 
        } else if (code == "4.1"){
          threatdf$T4.1[i] <- 1
        } else if (code == "4.2"){
          threatdf$T4.2[i] <- 1
        } else if (code == "4.3"){
          threatdf$T4.3[i] <- 1
        } else if (code == "4.4"){
          threatdf$T4.4[i] <- 1
          #### Biological resource use 
        } else if (code == "5.1"){
          threatdf$B5.1[i] <- 1
        } else if (code == "5.1.1"){
          threatdf$B5.1.1[i] <- 1
        } else if (code == "5.1.2"){
          threatdf$B5.1.2[i] <- 1
        } else if (code == "5.1.3"){
          threatdf$B5.1.3[i] <- 1
        } else if (code == "5.1.4"){
          threatdf$B5.1.4[i] <- 1
          
        } else if (code == "5.2"){
          threatdf$B5.2[i] <- 1
        } else if (code == "5.2.1"){
          threatdf$B5.2.1[i] <- 1
        } else if (code == "5.2.2"){
          threatdf$B5.2.2[i] <- 1
        } else if (code == "5.2.3"){
          threatdf$B5.2.3[i] <- 1
        } else if (code == "5.2.4"){
          threatdf$B5.2.4[i] <- 1
          
        } else if (code == "5.3"){
          threatdf$B5.3[i] <- 1
        } else if (code == "5.3.1"){
          threatdf$B5.3.1[i] <- 1
        } else if (code == "5.3.2"){
          threatdf$B5.3.2[i] <- 1
        } else if (code == "5.3.3"){
          threatdf$B5.3.3[i] <- 1
        } else if (code == "5.3.4"){
          threatdf$B5.3.4[i] <- 1
        } else if (code == "5.3.5"){
          threatdf$B5.3.5[i] <- 1
          
        } else if (code == "5.4"){
          threatdf$B5.4[i] <- 1
        } else if (code == "5.4.1"){
          threatdf$B5.4.1[i] <- 1
        } else if (code == "5.4.2"){
          threatdf$B5.4.2[i] <- 1
        } else if (code == "5.4.3"){
          threatdf$B5.4.3[i] <- 1
        } else if (code == "5.4.4"){
          threatdf$B5.4.4[i] <- 1
        } else if (code == "5.4.5"){
          threatdf$B5.4.5[i] <- 1
        } else if (code == "5.4.6"){
          threatdf$B5.4.6[i] <- 1
          
          #### Human intrustions 
        } else if (code == "6.1"){
          threatdf$H6.1[i] <- 1
        } else if (code == "6.2"){
          threatdf$H6.2[i] <- 1
        } else if (code == "6.3"){
          threatdf$H6.3[i] <- 1
          
          #### Natural system modifications 
        } else if (code == "7.1"){
          threatdf$N7.1[i] <- 1
        } else if (code == "7.1.1"){
          threatdf$N7.1.1[i] <- 1
        } else if (code == "7.1.2"){
          threatdf$N7.1.2[i] <- 1
        } else if (code == "7.1.3"){
          threatdf$N7.1.3[i] <- 1
          
        } else if (code == "7.2"){
          threatdf$N7.2[i] <- 1
        } else if (code == "7.2.1"){
          threatdf$N7.2.1[i] <- 1
        } else if (code == "7.2.2"){
          threatdf$N7.2.2[i] <- 1
        } else if (code == "7.2.3"){
          threatdf$N7.2.3[i] <- 1
        } else if (code == "7.2.4"){
          threatdf$N7.2.4[i] <- 1
        } else if (code == "7.2.5"){
          threatdf$N7.2.5[i] <- 1
        } else if (code == "7.2.6"){
          threatdf$N7.2.6[i] <- 1
        } else if (code == "7.2.7"){
          threatdf$N7.2.7[i] <- 1
        } else if (code == "7.2.8"){
          threatdf$N7.2.8[i] <- 1
        } else if (code == "7.2.9"){
          threatdf$N7.2.9[i] <- 1
        } else if (code == "7.2.10"){
          threatdf$N7.2.10[i] <- 1
        } else if (code == "7.2.11"){
          threatdf$N7.2.11[i] <- 1
          
        } else if (code == "7.3"){
          threatdf$N7.3[i] <- 1
          
          #### Invasive species/disease/introduced genes 
        } else if (code == "8.1"){
          threatdf$I8.1[i] <- 1
        } else if (code == "8.1.1"){
          threatdf$I8.1.1[i] <- 1
        } else if (code == "8.1.2"){
          threatdf$I8.1.2[i] <- 1
          
        } else if (code == "8.2"){
          threatdf$I8.2[i] <- 1
        } else if (code == "8.2.1"){
          threatdf$I8.2.1[i] <- 1
        } else if (code == "8.2.2"){
          threatdf$I8.2.2[i] <- 1
          
          
        } else if (code == "8.3"){
          threatdf$I8.3[i] <- 1
          
        } else if (code == "8.4"){
          threatdf$I8.4[i] <- 1
        } else if (code == "8.4.1"){
          threatdf$I8.4.1[i] <- 1
        } else if (code == "8.4.2"){
          threatdf$I8.4.2[i] <- 1
          
        } else if (code == "8.5"){
          threatdf$I8.5[i] <- 1
        } else if (code == "8.5.1"){
          threatdf$I8.5.1[i] <- 1
        } else if (code == "8.5.2"){
          threatdf$I8.5.2[i] <- 1
          
        } else if (code == "8.6"){
          threatdf$I8.6[i] <- 1
          
          #### Pollution
        } else if (code == "9.1"){
          threatdf$P9.1[i] <- 1
        } else if (code == "9.1.1"){
          threatdf$P9.1.1[i] <- 1
        } else if (code == "9.1.2"){
          threatdf$P9.1.2[i] <- 1
        } else if (code == "9.1.3"){
          threatdf$P9.1.3[i] <- 1
          
          
        } else if (code == "9.2"){
          threatdf$P9.2[i] <- 1
        } else if (code == "9.2.1"){
          threatdf$P9.2.1[i] <- 1
        } else if (code == "9.2.2"){
          threatdf$P9.2.2[i] <- 1
        } else if (code == "9.2.3"){
          threatdf$P9.2.3[i] <- 1
          
        } else if (code == "9.3"){
          threatdf$P9.3[i] <- 1
        } else if (code == "9.3.1"){
          threatdf$P9.3.1[i] <- 1
        } else if (code == "9.3.2"){
          threatdf$P9.3.2[i] <- 1
        } else if (code == "9.3.3"){
          threatdf$P9.3.3[i] <- 1
        } else if (code == "9.3.4"){
          threatdf$P9.3.4[i] <- 1
          
        } else if (code == "9.4"){
          threatdf$P9.4[i] <- 1
          
        } else if (code == "9.5"){
          threatdf$P9.5[i] <- 1
        } else if (code == "9.5.1"){
          threatdf$P9.5.1[i] <- 1
        } else if (code == "9.5.2"){
          threatdf$P9.5.2[i] <- 1
        } else if (code == "9.5.3"){
          threatdf$P9.5.3[i] <- 1
        } else if (code == "9.5.4"){
          threatdf$P9.5.4[i] <- 1
          
        } else if (code == "9.6"){
          threatdf$P9.6[i] <- 1
        } else if (code == "9.6.1"){
          threatdf$P9.6.1[i] <- 1
        } else if (code == "9.6.2"){
          threatdf$P9.6.2[i] <- 1
        } else if (code == "9.6.3"){
          threatdf$P9.6.3[i] <- 1
        } else if (code == "9.6.4"){
          threatdf$P9.6.4[i] <- 1
          
          #### Geological Events
        } else if (code == "10.1"){
          threatdf$G10.1[i] <- 1
        } else if (code == "10.2"){
          threatdf$G10.2[i] <- 1
        } else if (code == "10.3"){
          threatdf$G10.3[i] <- 1
          
          #### Climate Change
        } else if (code == "11.1"){
          threatdf$C11.1[i] <- 1
        } else if (code == "11.2"){
          threatdf$C11.2[i] <- 1
        } else if (code == "11.3"){
          threatdf$C11.3[i] <- 1
        } else if (code == "11.4"){
          threatdf$C11.4[i] <- 1
        } else if (code == "11.5"){
          threatdf$C11.5[i] <- 1
        }
      }
    }
    i <- 1 + i 
  }
  return(threatdf)
} #takes DF from sp_threats and populates empty threat table
```

#Sample sp that will be tested: 

#Amolops jinjiangensis (58212)
#Rhinella justinianoi (54675)
#Batrachuperus yenyuanensis (59088) 
#Barbourula busuangensis (23900)
#Eleutherodactylus cooki (7149) 
#Hypnobius arisanensis (59090)




```{r sample_sp, echo=TRUE}


#Choose a sample of species where spatial data is available 
#Create a small pop table, want to export to ArcGis and 
#see if I can create a join  
sample_species <- c("Amolops jinjiangensis","Rhinella justinianoi", "Batrachuperus yenyuanensis","Barbourula busuangensis", "Eleutherodactylus cooki")
practice <- sp_threats(sample_species)
practice
export_data <- pop_threat_tables(practice) 
write.table(x = export_data, file = "sample_species2.csv", sep = "\t")

```










